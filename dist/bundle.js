!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=14)}([function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));class o{static getDocumentWidth(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth)}static getDocumentHeight(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight)}static getMainCanvas(){return document.querySelector("#draw")}static getPreviewCanvas(){return document.querySelector("#preview")}static getMainDiv(){return document.querySelector("#main")}static getWaveformDiv(){return document.querySelector("#waveform")}static getEditorDiv(){return document.querySelector("#editor")}static getEditForm(){return document.forms.namedItem("edit")}static getLoadForm(){return document.forms.namedItem("load")}static getAvailableMaxWidthForMainDiv(){return.95*(this.getDocumentWidth()-this.getMainDivMarginLeft()-this.getEditorDivWidthInPx())}static getAvailableMaxHeightForMainDiv(){return this.getDocumentHeight()-60}static getEditorDivWidthInPx(){const t=this.getEditorDiv().style.width.replace("%","").replace("px","");return"0"==t||""==t?0:this.getDocumentWidth()*parseInt(t)/100+20}static getMainDivMarginLeft(){return Number(this.getMainDiv().style.marginLeft.replace("px",""))}static setHTMLInputElementValue(t,e){document.getElementById(t).value=""+e}static getPlayPauseButton(){return document.querySelector("[data-action='play']")}static getCCButton(){return document.querySelector("#cc")}static getWaveformZoomSlider(){return document.querySelector("[data-action='zoom']")}static getExportButton(){return document.querySelector("[data-action='export']")}static getToggleEditorButton(){return document.getElementById("toggle_editor_button")}static openEditor(){this.getToggleEditorButton().textContent="ðŸ–‰ Close Editor",o.getEditorDiv().style.width="40%",o.getEditorDiv().style.borderLeft="1px solid black",o.getEditorDiv().style.paddingLeft="10px",o.getEditorDiv().style.paddingRight="10px"}static closeEditor(){this.getToggleEditorButton().textContent="ðŸ–‰ Open Editor",o.getEditorDiv().style.width="0",o.getEditorDiv().style.borderLeft="",o.getEditorDiv().style.paddingLeft="0",o.getEditorDiv().style.paddingRight="0"}static removeLoadModalDialog(){document.getElementById("load_modal_dialog").remove()}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return i}));class o{constructor(t,e,n){this.canvas=t,this.type=e,this.options=n}do(t){throw new Error("Not implemented")}execute(){this.do(this.canvas.mainContext)}preview(){this.do(this.canvas.previewContext)}}class i{}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var o=n(1);class i extends o.b{constructor(t,e,n,o){super(),this.topLeftX=t,this.topLeftY=e,this.bottomRightX=n,this.bottomRightY=o}}class r extends o.a{constructor(t,e){super(t,"zoom",e)}do(t){this.canvas.render(this.options.topLeftX,this.options.topLeftY,this.options.bottomRightX,this.options.bottomRightY)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var o=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))};class i{static localFileContentsToBase64String(t){return o(this,void 0,void 0,(function*(){return fetch(t).then(t=>t.arrayBuffer()).then(t=>btoa(function(t){const e=[];for(let n=0;n<t.length;n+=32768)e.push(String.fromCharCode.apply(null,t.subarray(n,n+32768)));return e.join("")}(new Uint8Array(t))))}))}static localFileContentsToString(t){return o(this,void 0,void 0,(function*(){return fetch(t).then(t=>t.text())}))}static localFileContentsToBlob(t){return o(this,void 0,void 0,(function*(){return fetch(t).then(t=>t.blob())}))}static saveBlobToFile(t,e){const n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=e,document.body.appendChild(o),o.click(),setTimeout(()=>{document.body.removeChild(o),window.URL.revokeObjectURL(n)},0)}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var o=n(1);class i extends o.b{constructor(t,e,n,o,i,r){super(),this.topLeftX=t,this.topLeftY=e,this.bottomRightX=n,this.bottomRightY=o,this.borderSize=i,this.color=r}}class r extends o.a{constructor(t,e){super(t,"draw_rectangle",e)}do(t){const e=this.canvas.getPointProjectionOnCanvas(this.options.topLeftX,this.options.topLeftY),n=e.x,o=e.y,i=this.canvas.getPointProjectionOnCanvas(this.options.bottomRightX,this.options.bottomRightY),r=i.x-n,s=i.y-o;t.save(),t.beginPath(),t.lineWidth=this.options.borderSize,t.strokeStyle=this.options.color,t.rect(n,o,r,s),t.stroke(),t.restore()}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var o=n(1);class i extends o.b{constructor(t,e,n,o,i){super(),this.centerX=t,this.centerY=e,this.radius=n,this.borderSize=o,this.color=i}}class r extends o.a{constructor(t,e){super(t,"draw_circle",e)}do(t){const e=this.canvas.getPointProjectionOnCanvas(this.options.centerX,this.options.centerY),n=e.x,o=e.y,i=this.canvas.getImageRatio(),r=this.options.radius/i.ratioWidth,s=this.options.radius/i.ratioHeight;t.save(),t.beginPath(),t.lineWidth=this.options.borderSize,t.strokeStyle=this.options.color,t.arc(n,o,r,0,Math.PI),t.stroke(),t.beginPath(),t.arc(n,o,s,Math.PI,2*Math.PI),t.stroke(),t.restore()}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var o=n(1);class i extends o.b{constructor(t,e,n,o,i){super(),this.centerX=t,this.centerY=e,this.radius=n,this.lineWidth=o,this.color=i}}class r extends o.a{constructor(t,e){super(t,"draw_xcross",e)}do(t){const e=this.canvas.getPointProjectionOnCanvas(this.options.centerX,this.options.centerY),n=e.x,o=e.y,i=this.canvas.getImageRatio(),r=this.options.radius/i.ratioWidth,s=this.options.radius/i.ratioHeight;t.save(),t.translate(n,o),t.rotate(Math.PI/4),t.translate(-n,-o),t.lineWidth=this.options.lineWidth,t.strokeStyle=this.options.color,t.beginPath(),t.moveTo(n-r,o),t.lineTo(n+r,o),t.stroke(),t.moveTo(n,o-s),t.lineTo(n,o+s),t.stroke(),t.restore()}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var o=n(1);class i extends o.b{constructor(t,e,n,o,i,r,s){super(),this.text=t,this.position=e,this.backgroundColor=n,this.backgroundColorOpacity=o,this.textColor=i,this.fontSize=r,this.font=s}}class r extends o.a{constructor(t,e){super(t,"subtitle",e)}do(t){if(this.canvas.ccEnabled){const e=this.canvas.getWidthAndHeight(),n=e.width/2,o=10,i=10;t.save(),t.font=this.options.fontSize+"px "+this.options.font,t.textAlign="center",t.textBaseline="bottom";const r=this.options.text.split(new RegExp("\\r?\\n|\\r"));let s=0;r.forEach(e=>{const n=t.measureText(e),o=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent+2*i;s+=o});let a=Math.max(Math.min(e.height*this.options.position/100-s/2,e.height-s),0);r.forEach(r=>{const s=t.measureText(r),c=s.width+2*o,l=s.actualBoundingBoxAscent+s.actualBoundingBoxDescent+2*i,u=n-Math.abs(s.actualBoundingBoxLeft)-o;a+=l;const h=a-s.actualBoundingBoxAscent-i;t.fillStyle=this.options.backgroundColor,t.globalAlpha=this.options.backgroundColorOpacity/100,t.fillRect(u,h,c,l),t.globalAlpha=1,t.fillStyle=this.options.textColor,t.fillText(r,n,a,e.width)}),t.restore()}}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return r}));var o=n(1);class i extends o.a{constructor(t,e){super(t,"focus_rectangle",e)}do(t){const e=this.canvas.getPointProjectionOnCanvas(this.options.topLeftX,this.options.topLeftY),n=e.x,o=e.y,i=this.canvas.getPointProjectionOnCanvas(this.options.bottomRightX,this.options.bottomRightY),r=i.x,s=i.y,a=this.canvas.getPointProjectionOnCanvas(this.canvas.imgTopLeftX,this.canvas.imgTopLeftY),c=this.canvas.getPointProjectionOnCanvas(this.canvas.imgBottomRightX,this.canvas.imgBottomRightY);t.save(),t.globalAlpha=.75,t.filter="blur(4px)";const l=new Path2D;l.moveTo(a.x,a.y),l.lineTo(c.x,a.y),l.lineTo(c.x,c.y),l.lineTo(a.x,c.y),l.moveTo(a.x,a.y),l.lineTo(n,o),l.lineTo(r,o),l.lineTo(r,s),l.lineTo(n,s),l.lineTo(n,o),l.closePath(),t.fill(l,"evenodd"),t.restore()}}class r extends o.b{constructor(t,e,n,o){super(),this.topLeftX=t,this.topLeftY=e,this.bottomRightX=n,this.bottomRightY=o}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var o=n(1);class i extends o.b{constructor(t,e,n,o){super(),this.centerX=t,this.centerY=e,this.radius=n,this.color=o}}class r extends o.a{constructor(t,e){super(t,"draw_point",e)}do(t){const e=this.canvas.getPointProjectionOnCanvas(this.options.centerX,this.options.centerY),n=e.x,o=e.y,i=this.canvas.getImageRatio(),r=this.options.radius/i.ratioWidth,s=this.options.radius/i.ratioHeight;t.save(),t.beginPath(),t.fillStyle=this.options.color,t.strokeStyle=this.options.color,t.arc(n,o,r,0,Math.PI),t.fill(),t.beginPath(),t.arc(n,o,s,Math.PI,2*Math.PI),t.fill(),t.restore()}}},function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}));var o=n(1);class i extends o.b{constructor(t,e,n,o,i,r){super(),this.originX=t,this.originY=e,this.destinationX=n,this.destinationY=o,this.lineWidth=i,this.color=r}}class r extends o.a{constructor(t,e){super(t,"draw_arrow",e)}do(t){const e=this.canvas.getPointProjectionOnCanvas(this.options.originX,this.options.originY),n=e.x,o=e.y,i=this.canvas.getPointProjectionOnCanvas(this.options.destinationX,this.options.destinationY),r=i.x,s=i.y;t.save(),t.lineWidth=this.options.lineWidth,t.strokeStyle=this.options.color,t.beginPath(),t.moveTo(n,o),t.lineTo(r,s),t.stroke(),t.closePath(),t.beginPath();const a=2*this.options.lineWidth;let c=Math.atan2(s-o,r-n);t.moveTo(a*Math.cos(c)+r,a*Math.sin(c)+s),c+=1/3*(2*Math.PI),t.lineTo(a*Math.cos(c)+r,a*Math.sin(c)+s),c+=1/3*(2*Math.PI),t.lineTo(a*Math.cos(c)+r,a*Math.sin(c)+s),t.closePath(),t.fill(),t.restore()}}},function(t,e,n){"use strict";n.r(e),n.d(e,"Canvas",(function(){return r}));var o=n(2),i=n(0);class r{constructor(t){this.img=new Image,this.img.src=t,this.img.addEventListener("load",()=>{this.renderImage()}),this.imgTopLeftX=0,this.imgTopLeftY=0,this.imgBottomRightX=this.img.naturalWidth,this.imgBottomRightY=this.img.naturalHeight,this.mainCanvas=i.a.getMainCanvas(),this.mainContext=this.mainCanvas.getContext("2d"),this.previewCanvas=i.a.getPreviewCanvas(),this.previewContext=this.previewCanvas.getContext("2d"),this.clickPosition={x:0,y:0},this.ccEnabled=!1}render(t,e,n,o){this.imgTopLeftX=t,this.imgTopLeftY=e,this.imgBottomRightX=n,this.imgBottomRightY=o;const r=this.imgBottomRightX-this.imgTopLeftX,s=this.imgBottomRightY-this.imgTopLeftY,a=r/s,c=i.a.getAvailableMaxWidthForMainDiv(),l=i.a.getAvailableMaxHeightForMainDiv();let u=Math.min(c,r),h=u/a;h>=l&&(h=l,u=h*a),this.mainCanvas.width=u,this.mainCanvas.height=h,this.mainContext.drawImage(this.img,this.imgTopLeftX,this.imgTopLeftY,r,s,0,0,u,h),this.previewCanvas.width=u,this.previewCanvas.height=h,this.previewCanvas.style.display="none"}renderFullImage(){this.render(0,0,this.img.naturalWidth,this.img.naturalHeight)}renderImage(){this.render(this.imgTopLeftX,this.imgTopLeftY,this.imgBottomRightX,this.imgBottomRightY)}getWidthAndHeight(){return{width:this.mainCanvas.width,height:this.mainCanvas.height}}getImageRatio(){const t=this.imgBottomRightX-this.imgTopLeftX,e=this.imgBottomRightY-this.imgTopLeftY,n=this.getWidthAndHeight();return{ratioWidth:t/n.width,ratioHeight:e/n.height}}getPointProjectionOnCanvas(t,e){const n=this.getImageRatio();return{x:(t-this.imgTopLeftX)/n.ratioWidth,y:(e-this.imgTopLeftY)/n.ratioHeight}}getCursorPositionOnCanvas(t){const e=this.mainCanvas.getBoundingClientRect(),n=t.clientX-e.left,o=t.clientY-e.top,i=this.getImageRatio();return{x:Math.floor(n*i.ratioWidth)+this.imgTopLeftX,y:Math.floor(o*i.ratioHeight)+this.imgTopLeftY}}addClickEventListener(t){this.mainCanvas.addEventListener("click",t)}executeAction(t){t.execute()}executeActions(t){null==t.find(t=>t instanceof o.a)&&this.renderFullImage(),this.renderImage(),t.forEach(t=>{this.executeAction(t)})}previewAction(t,e){this.previewCanvas.style.display="block",t.preview(),setTimeout(()=>{if(this.previewContext.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),this.previewCanvas.style.display="none",t instanceof o.a){const t=new o.a(this,new o.b(0,0,this.img.naturalWidth,this.img.naturalHeight));this.executeAction(t)}},e)}}},function(t,e,n){"use strict";n.r(e),n.d(e,"App",(function(){return y}));class o{constructor(t){this.loadForm=t}getExamplesSpans(){return document.querySelector("#examples").getElementsByTagName("span")}getOkButton(){return this.loadForm.elements.namedItem("load_ok")}getImageInput(){return this.loadForm.elements.namedItem("image")}getAudioInput(){return this.loadForm.elements.namedItem("audio")}getActionsInput(){return this.loadForm.elements.namedItem("actions")}displayLoadErrorMessage(t){document.getElementById("loading_text").innerHTML=t}}class i{constructor(t,e,n){this.imageData=t,this.audioBlob=e,this.jsonActions=n}}class r extends Error{constructor(t){super(t)}}var s=n(3),a=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))};class c{constructor(t){this.loadForm=t}load(){return a(this,void 0,void 0,(function*(){const t=this.loadForm.getImageInput(),e=this.loadForm.getAudioInput(),n=this.loadForm.getActionsInput(),o=new Promise(e=>{if(1!=t.files.length)throw new r("No image selected");{const n=new FileReader;n.readAsDataURL(t.files[0]),n.onloadend=()=>e(n.result)}}),a=new Promise(t=>{if(1!=e.files.length)throw new r("No audio selected");{const n=new FileReader;n.readAsArrayBuffer(e.files[0]),n.onloadend=()=>{t(new Blob([new Uint8Array(n.result)]))}}}),c=new Promise(t=>{if(1==n.files.length){const e=new FileReader;e.readAsDataURL(n.files[0]),e.onloadend=()=>{s.a.localFileContentsToString("./assets/actions_json_schema.json").then(n=>{const o=JSON.parse(decodeURIComponent(escape(atob(e.result.split(",")[1])))),i=new Ajv,s=JSON.parse(n);if(!i.addSchema(s,"schema").validate("schema",o))throw new r("Invalid JSON : "+JSON.stringify(i.errors,null,2));t(o)})}}else t(JSON.parse("[]"))});return new i(yield o,yield a,yield c)}))}}var l=function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((o=o.apply(t,e||[])).next())}))};class u{constructor(t){switch(t){case"ðŸ‡«ðŸ‡·":this.localRelativePathToImage="./examples/language_learning/krashen_spock.png",this.localRelativePathToAudio="./examples/language_learning/fr/krashen_spock.wav",this.localRelativePathToActions="./examples/language_learning/fr/krashen_spock.json";break;case"ðŸ‡©ðŸ‡ª":this.localRelativePathToImage="./examples/language_learning/krashen_spock.png",this.localRelativePathToAudio="./examples/language_learning/de/krashen_spock.wav",this.localRelativePathToActions="./examples/language_learning/de/krashen_spock.json";break;case"ðŸ‘¨â€ðŸ’»":this.localRelativePathToImage="./examples/it_architecture/data_lake_on_gcp.png",this.localRelativePathToAudio="./examples/it_architecture/data_lake_on_gcp.wav",this.localRelativePathToActions="./examples/it_architecture/data_lake_on_gcp.json";break;default:throw new Error("Unknown example")}}load(){return l(this,void 0,void 0,(function*(){const t=yield s.a.localFileContentsToBase64String(this.localRelativePathToImage),e=yield s.a.localFileContentsToBlob(this.localRelativePathToAudio),n=yield s.a.localFileContentsToString(this.localRelativePathToActions),o=this.localRelativePathToImage.split("."),r=o[o.length-1];return new i("data:image/"+r+";base64,"+t,e,JSON.parse(n))}))}}var h=n(13),d=n(11);class m{constructor(t){this.editForm=t}setOnSubmit(t){this.editForm.onsubmit=t}setOnReset(t){this.editForm.onreset=t}getFormInputElement(t){return this.editForm.elements.namedItem(t)}getActions(){return this.editForm.elements.namedItem("action_type")}getRegionStartInput(){return this.getFormInputElement("start")}getRegionEndInput(){return this.getFormInputElement("end")}getRegionNoteInput(){return this.getFormInputElement("note")}getFormSelectElement(t){return this.editForm.elements.namedItem(t)}getFormButtonElement(t){return this.editForm.elements.namedItem(t)}getAllDivs(){return this.editForm.querySelectorAll("div")}getDeleteRegionButton(){return this.editForm.elements.namedItem("delete_region")}displayAndReturnActionDiv(t){const e="action_"+t;let n;return this.getAllDivs().forEach((function(t){if(null!=t.attributes.name){const o=t.attributes.name.value;e==o?(t.style.opacity="1",t.style.display="block",n=t):(t.style.opacity="0",t.style.display="none")}})),n}show(){this.editForm.style.height="55%"}hide(){this.editForm.style.height="0"}reset(){this.editForm.reset()}}var g=n(4),p=n(5),v=n(6),f=n(2),w=n(7),b=n(8),_=n(0),E=n(9),I=n(10);class F{constructor(t,e){this.editAction=t=>{if(this.getRegionStartInput().value=""+Math.round(100*(t.start+Number.EPSILON))/100,this.getRegionEndInput().value=""+Math.round(100*(t.end+Number.EPSILON))/100,null!=t.data.note?this.editForm.getRegionNoteInput().value=""+t.data.note:this.editForm.getRegionNoteInput().value="",0!==Object.keys(t.data).length||t.data.constructor!==Object){const e=t.data;switch(e.action.type){case"draw_arrow":this.getFormInputElement("action_type").value="draw_arrow",this.getFormInputElement("draw_arrow_originX").value=e.action.options.originX,this.getFormInputElement("draw_arrow_originY").value=e.action.options.originY,this.getFormInputElement("draw_arrow_destinationX").value=e.action.options.destinationX,this.getFormInputElement("draw_arrow_destinationY").value=e.action.options.destinationY,this.getFormInputElement("draw_arrow_lineWidth").value=e.action.options.lineWidth,this.getFormInputElement("draw_arrow_color").value=e.action.options.color;break;case"draw_circle":this.getFormInputElement("action_type").value="draw_circle",this.getFormInputElement("draw_circle_centerX").value=e.action.options.centerX,this.getFormInputElement("draw_circle_centerY").value=e.action.options.centerY,this.getFormInputElement("draw_circle_radius").value=e.action.options.radius,this.getFormInputElement("draw_circle_borderSize").value=e.action.options.borderSize,this.getFormInputElement("draw_circle_color").value=e.action.options.color;break;case"draw_rectangle":this.getFormInputElement("action_type").value="draw_rectangle",this.getFormInputElement("draw_rectangle_topLeftX").value=e.action.options.topLeftX,this.getFormInputElement("draw_rectangle_topLeftY").value=e.action.options.topLeftY,this.getFormInputElement("draw_rectangle_bottomRightX").value=e.action.options.bottomRightX,this.getFormInputElement("draw_rectangle_bottomRightY").value=e.action.options.bottomRightY,this.getFormInputElement("draw_rectangle_borderSize").value=e.action.options.borderSize,this.getFormInputElement("draw_rectangle_color").value=e.action.options.color;break;case"draw_point":this.getFormInputElement("action_type").value="draw_point",this.getFormInputElement("draw_point_centerX").value=e.action.options.centerX,this.getFormInputElement("draw_point_centerY").value=e.action.options.centerY,this.getFormInputElement("draw_point_radius").value=e.action.options.radius,this.getFormInputElement("draw_point_color").value=e.action.options.color;break;case"draw_xcross":this.getFormInputElement("action_type").value="draw_xcross",this.getFormInputElement("draw_xcross_centerX").value=e.action.options.centerX,this.getFormInputElement("draw_xcross_centerY").value=e.action.options.centerY,this.getFormInputElement("draw_xcross_radius").value=e.action.options.radius,this.getFormInputElement("draw_xcross_color").value=e.action.options.color;break;case"zoom":this.getFormInputElement("action_type").value="zoom",this.getFormInputElement("zoom_topLeftX").value=e.action.options.topLeftX,this.getFormInputElement("zoom_topLeftY").value=e.action.options.topLeftY,this.getFormInputElement("zoom_bottomRightX").value=e.action.options.bottomRightX,this.getFormInputElement("zoom_bottomRightY").value=e.action.options.bottomRightY;break;case"subtitle":this.getFormInputElement("action_type").value="subtitle",this.getFormInputElement("subtitle_text").value=e.action.options.text,this.getFormInputElement("subtitle_position").value=e.action.options.position,this.getFormInputElement("subtitle_backgroundColor").value=e.action.options.backgroundColor,this.getFormInputElement("subtitle_textColor").value=e.action.options.textColor;break;case"focus_rectangle":this.getFormInputElement("action_type").value="focus_rectangle",this.getFormInputElement("focus_rectangle_topLeftX").value=e.action.options.topLeftX,this.getFormInputElement("focus_rectangle_topLeftY").value=e.action.options.topLeftY,this.getFormInputElement("focus_rectangle_bottomRightX").value=e.action.options.bottomRightX,this.getFormInputElement("focus_rectangle_bottomRightY").value=e.action.options.bottomRightY;break;default:this.getFormInputElement("action_type").value="default"}}else this.getFormInputElement("action_type").value="draw_point";this.getActions().forEach(t=>{t.checked&&t.dispatchEvent(new Event("click"))}),this.editForm.show(),this.editForm.setOnSubmit(e=>{e.preventDefault();const n=this.getFormInputElement("action_type").value;let o;o=this.getActionFromActionType(n),t.update({start:this.editForm.getRegionStartInput().value,end:this.editForm.getRegionEndInput().value,data:{action:o,note:this.editForm.getRegionNoteInput().value}}),this.editForm.reset()}),this.editForm.setOnReset(()=>{this.editForm.hide(),this.currentActionDiv=void 0})},this.editForm=t,this.getActions().forEach(t=>{t.addEventListener("click",()=>{const e=t.value;this.displayActionDiv(e)})}),this.getFormButtonElement("action_preview").addEventListener("click",t=>{this.preview(t)}),this.canvas=e,this.canvas.addClickEventListener(t=>this.clickOnCanvas(t))}getFormInputElement(t){return this.editForm.getFormInputElement(t)}getFormButtonElement(t){return this.editForm.getFormButtonElement(t)}getActions(){return this.editForm.getActions()}getRegionStartInput(){return this.editForm.getRegionStartInput()}getRegionEndInput(){return this.editForm.getRegionEndInput()}getActionFromActionType(t){let e;switch(t){case"draw_arrow":e=new I.a(this.canvas,new I.b(Number(this.getFormInputElement("draw_arrow_originX").value),Number(this.getFormInputElement("draw_arrow_originY").value),Number(this.getFormInputElement("draw_arrow_destinationX").value),Number(this.getFormInputElement("draw_arrow_destinationY").value),Number(this.getFormInputElement("draw_arrow_lineWidth").value),this.getFormInputElement("draw_arrow_color").value));break;case"draw_circle":e=new p.a(this.canvas,new p.b(Number(this.getFormInputElement("draw_circle_centerX").value),Number(this.getFormInputElement("draw_circle_centerY").value),Number(this.getFormInputElement("draw_circle_radius").value),Number(this.getFormInputElement("draw_circle_borderSize").value),this.getFormInputElement("draw_circle_color").value));break;case"draw_point":e=new E.a(this.canvas,new E.b(Number(this.getFormInputElement("draw_point_centerX").value),Number(this.getFormInputElement("draw_point_centerY").value),Number(this.getFormInputElement("draw_point_radius").value),this.getFormInputElement("draw_point_color").value));break;case"draw_rectangle":e=new g.a(this.canvas,new g.b(Number(this.getFormInputElement("draw_rectangle_topLeftX").value),Number(this.getFormInputElement("draw_rectangle_topLeftY").value),Number(this.getFormInputElement("draw_rectangle_bottomRightX").value),Number(this.getFormInputElement("draw_rectangle_bottomRightY").value),Number(this.getFormInputElement("draw_rectangle_borderSize").value),this.getFormInputElement("draw_rectangle_color").value));break;case"draw_xcross":e=new v.a(this.canvas,new v.b(Number(this.getFormInputElement("draw_xcross_centerX").value),Number(this.getFormInputElement("draw_xcross_centerY").value),Number(this.getFormInputElement("draw_xcross_radius").value),Number(this.getFormInputElement("draw_xcross_lineWidth").value),this.getFormInputElement("draw_xcross_color").value));break;case"zoom":e=new f.a(this.canvas,new f.b(Number(this.getFormInputElement("zoom_topLeftX").value),Number(this.getFormInputElement("zoom_topLeftY").value),Number(this.getFormInputElement("zoom_bottomRightX").value),Number(this.getFormInputElement("zoom_bottomRightY").value)));break;case"subtitle":e=new w.a(this.canvas,new w.b(this.getFormInputElement("subtitle_text").value,Number(this.getFormInputElement("subtitle_position").value),this.getFormInputElement("subtitle_backgroundColor").value,Number(this.getFormInputElement("subtitle_backgroundColorOpacity").value),this.getFormInputElement("subtitle_textColor").value,Number(this.getFormInputElement("subtitle_fontSize").value),"Roboto Medium"));break;case"focus_rectangle":e=new b.a(this.canvas,new b.b(Number(this.getFormInputElement("focus_rectangle_topLeftX").value),Number(this.getFormInputElement("focus_rectangle_topLeftY").value),Number(this.getFormInputElement("focus_rectangle_bottomRightX").value),Number(this.getFormInputElement("focus_rectangle_bottomRightY").value)));break;default:throw new Error("Invalid action type : "+t)}return e}displayActionDiv(t){this.currentActionDiv=this.editForm.displayAndReturnActionDiv(t)}resetActionDiv(){this.currentActionDiv=void 0}preview(t){let e;t.preventDefault(),this.editForm.getAllDivs().forEach(t=>{if(t.id.startsWith("action_")&&"none"!=t.style.display){const n=t.id.substr(7);e=this.getActionFromActionType(n)}});const n=this.getFormButtonElement("action_preview");n.disabled=!0;this.canvas.previewAction(e,2e3),setTimeout((function(){n.disabled=!1}),2e3)}clickOnCanvas(t){const e=this.canvas.getCursorPositionOnCanvas(t),n=e.x,o=e.y;if(null!=this.currentActionDiv){const t=this.currentActionDiv.id,e=t.substr(7);let i=document.querySelector("div#"+t+" input[type=radio]:checked");if(null!=i)switch(t){case"action_draw_arrow":i.id=="set_"+e+"_origin"?(_.a.setHTMLInputElementValue(e+"_originX",n),_.a.setHTMLInputElementValue(e+"_originY",o)):i.id=="set_"+e+"_destination"&&(_.a.setHTMLInputElementValue(e+"_destinationX",n),_.a.setHTMLInputElementValue(e+"_destinationY",o));break;case"action_draw_circle":case"action_draw_point":i.id=="set_"+e+"_center"&&(_.a.setHTMLInputElementValue(e+"_centerX",n),_.a.setHTMLInputElementValue(e+"_centerY",o));break;case"action_draw_rectangle":i.id=="set_"+e+"_topLeft"?(_.a.setHTMLInputElementValue(e+"_topLeftX",n),_.a.setHTMLInputElementValue(e+"_topLeftY",o)):i.id=="set_"+e+"_bottomRight"&&(_.a.setHTMLInputElementValue(e+"_bottomRightX",n),_.a.setHTMLInputElementValue(e+"_bottomRightY",o));break;case"action_draw_xcross":i.id=="set_"+e+"_center"&&(_.a.setHTMLInputElementValue(e+"_centerX",n),_.a.setHTMLInputElementValue(e+"_centerY",o));break;case"action_zoom":i.id=="set_"+e+"_topLeft"?(_.a.setHTMLInputElementValue(e+"_topLeftX",n),_.a.setHTMLInputElementValue(e+"_topLeftY",o)):i.id=="set_"+e+"_bottomRight"&&(_.a.setHTMLInputElementValue(e+"_bottomRightX",n),_.a.setHTMLInputElementValue(e+"_bottomRightY",o));break;case"action_subtitle":break;case"action_focus_rectangle":i.id=="set_"+e+"_topLeft"?(_.a.setHTMLInputElementValue(e+"_topLeftX",n),_.a.setHTMLInputElementValue(e+"_topLeftY",o)):i.id=="set_"+e+"_bottomRight"&&(_.a.setHTMLInputElementValue(e+"_bottomRightX",n),_.a.setHTMLInputElementValue(e+"_bottomRightY",o));break;default:throw new Error("Invalid action : ["+t+"]")}}}}class y{run(){const t=new o(_.a.getLoadForm());t.getOkButton().addEventListener("click",()=>{new c(t).load().then(t=>{this.init(t)}).catch(e=>{e instanceof r?t.displayLoadErrorMessage(e.message):console.log(e)})});const e=t.getExamplesSpans();for(let t=0;t<e.length;t++){const n=e[t];n.addEventListener("click",()=>{new u(n.innerText).load().then(t=>{this.init(t)})})}}init(t){const e=t.imageData,n=t.audioBlob,o=t.jsonActions,i=new d.Canvas(e),r=new F(new m(_.a.getEditForm()),i);new h.CustomWaveSurfer(n,o,i,r),_.a.removeLoadModalDialog(),_.a.getToggleEditorButton().addEventListener("click",()=>{const t=_.a.getEditorDiv().style.width;"0px"==t||""==t?_.a.openEditor():_.a.closeEditor(),i.renderImage()});const s=_.a.getCCButton();s.addEventListener("click",()=>{i.ccEnabled=!i.ccEnabled,i.ccEnabled?s.src="assets/images/cc.png":s.src="assets/images/nocc.png"}),window.addEventListener("resize",()=>{i.renderImage()})}}},function(t,e,n){"use strict";n.r(e),n.d(e,"CustomWaveSurfer",(function(){return g}));var o=n(4),i=n(5),r=n(6),s=n(2),a=n(7),c=n(8),l=n(3);class u{static isEquivalent(t,e){if(typeof t!=typeof e)return!1;const n=Object.getOwnPropertyNames(t),o=Object.getOwnPropertyNames(e);if(n.length!=o.length)return!1;for(let o=0;o<n.length;o++){const i=n[o];if(t[i]!==e[i])return!1}return!0}}var h=n(0),d=n(9),m=n(10);class g{constructor(t,e,n,o){this.sortedRegions=[],this.currentActions=[],this.updateBeginAndEnd=t=>{t.start<0&&(t.start=0),this.editFormHandler.getRegionStartInput().value=""+Math.round(100*(t.start+Number.EPSILON))/100,this.editFormHandler.getRegionEndInput().value=""+Math.round(100*(t.end+Number.EPSILON))/100},this.redrawAllRegionsSuperposed=()=>{const t=this.getRegionsIdSorted();for(const e of t){const n=this.wavesurfer.regions.list[e];this.drawRegionSuperposed(n,t)}},this.saveRegions=()=>{this.sortedRegions=this.getRegionsIdSorted().map(t=>{const e=this.wavesurfer.regions.list[t];return{start:Math.round(100*(e.start+Number.EPSILON))/100,end:Math.round(100*(e.end+Number.EPSILON))/100,data:e.data}}),this.redrawAllRegionsSuperposed(),localStorage.regions=JSON.stringify(this.sortedRegions,(t,e)=>{switch(t){case"canvas":return;default:return e}},2)},this.canvas=n,this.editFormHandler=o,this.wavesurfer=WaveSurfer.create({container:h.a.getWaveformDiv(),height:200,pixelRatio:1,minPxPerSec:100,scrollParent:!0,normalize:!0,splitChannels:!1,backend:"MediaElement",plugins:[WaveSurfer.regions.create(),WaveSurfer.minimap.create({height:30,waveColor:"#ddd",progressColor:"#999"}),WaveSurfer.timeline.create({container:"#wave-timeline"}),WaveSurfer.cursor.create()]}),this.wavesurfer.on("error",(function(t){console.warn(t)}));const i=new Audio;i.src=URL.createObjectURL(t),this.wavesurfer.load(i),this.wavesurfer.on("ready",()=>{this.wavesurfer.enableDragSelection({color:"rgba(128, 204, 0, 0.5)"}),this.loadRegions(e),this.saveRegions(),this.wavesurfer.seekAndCenter(0),this.initZoomSlider()}),this.initPlayButton(),this.initExportButton(),this.editFormHandler.editForm.getRegionStartInput().addEventListener("input",()=>{this.selectedRegion.update({start:this.editFormHandler.editForm.getRegionStartInput().value})}),this.editFormHandler.editForm.getRegionEndInput().addEventListener("input",()=>{this.selectedRegion.update({end:this.editFormHandler.editForm.getRegionEndInput().value})}),this.editFormHandler.editForm.getDeleteRegionButton().addEventListener("click",()=>{this.deleteRegion(this.selectedRegion),this.redrawAllRegionsSuperposed()}),this.wavesurfer.on("region-click",this.editFormHandler.editAction),this.wavesurfer.on("region-click",t=>{this.selectedRegion=t}),this.wavesurfer.on("region-updated",this.saveRegions),this.wavesurfer.on("region-updated",this.updateBeginAndEnd),this.wavesurfer.on("region-update-end",this.saveRegions),this.wavesurfer.on("region-update-end",this.redrawAllRegionsSuperposed),this.wavesurfer.on("region-removed",this.saveRegions),this.wavesurfer.on("region-play",(function(t){t.once("out",(function(){this.wavesurfer.play(t.start),this.wavesurfer.pause()}))})),this.wavesurfer.on("region-mouseenter",t=>{this.regionChangeHandles(t,"10%","10px")}),this.wavesurfer.on("region-mouseleave",t=>{this.regionChangeHandles(t,"1%","3px")}),this.wavesurfer.on("play",()=>{h.a.getPlayPauseButton().textContent="â¸ï¸  PAUSE",h.a.getPlayPauseButton().style.backgroundColor="#ff751f"}),this.wavesurfer.on("pause",()=>{h.a.getPlayPauseButton().textContent="â–¶ï¸  PLAY",h.a.getPlayPauseButton().style.backgroundColor="#009e47"}),this.wavesurfer.on("audioprocess",()=>{const t=this.wavesurfer.getCurrentTime();for(const e of this.sortedRegions)if(null!=e.data.action){const n=e.data.action,o=t>=e.start&&t<=e.end,i=null!=this.currentActions.find(t=>u.isEquivalent(t,n));if(o)i||this.currentActions.push(n);else{t>=e.end&&i&&(this.currentActions=this.currentActions.filter(t=>!u.isEquivalent(t,n)))}}this.canvas.executeActions(this.currentActions)}),this.wavesurfer.on("seek",()=>{if(null!=this.selectedRegion){const t=this.wavesurfer.getCurrentTime();(t<=this.selectedRegion.start||t>=this.selectedRegion.end)&&(this.selectedRegion=void 0,this.editFormHandler.resetActionDiv(),this.editFormHandler.editForm.reset())}}),this.wavesurfer.on("seek",()=>{const t=this.wavesurfer.getCurrentTime();this.currentActions=[];for(const e of this.sortedRegions)if(null!=e.data.action){const n=e.data.action,o=t>=e.start&&t<=e.end,i=null!=this.currentActions.find(t=>u.isEquivalent(t,n));if(o)i||this.currentActions.push(n);else{const o=t>=e.end,r=t<e.start,s=t>e.end;(o&&i||r||s)&&(this.currentActions=this.currentActions.filter(t=>!u.isEquivalent(t,n)))}}this.canvas.executeActions(this.currentActions)}),this.wavesurfer.on("finish",()=>{this.currentActions=[],this.selectedRegion=void 0,this.canvas.renderFullImage()})}regionChangeHandles(t,e,n){t.element.childNodes.forEach((function(t){"HANDLE"==t.nodeName&&(t.style.width=e,t.style["max-width"]=n)}))}drawRegionSuperposed(t,e){const n=t.element;n.title=Math.round(100*(t.start+Number.EPSILON))/100+" -> "+Math.round(100*(t.end+Number.EPSILON))/100,n.style.height="10%";let o=0;for(const n of e){if(t.id==n)break;const e=t.start,i=t.end,r=this.wavesurfer.regions.list[n],s=r.start,a=r.end,c=e<=s&&i>=a,l=e>=s&&e<a,u=i>s&&i<=a;if(e>=s&&i<=a||l||u||c){Number(r.element.style.top.replace("px",""))<=o&&(o+=this.wavesurfer.params.height/10)}}n.style.top=o+"px"}initZoomSlider(){const t=h.a.getWaveformZoomSlider();t.value=this.wavesurfer.params.minPxPerSec,t.min=""+this.wavesurfer.params.minPxPerSec/5,t.max=""+10*this.wavesurfer.params.minPxPerSec,t.step=""+.1*this.wavesurfer.params.minPxPerSec,t.addEventListener("input",()=>{this.wavesurfer.zoom(Number(t.value))}),this.wavesurfer.zoom(Number(t.value))}initPlayButton(){h.a.getPlayPauseButton().addEventListener("click",()=>this.wavesurfer.playPause())}initExportButton(){h.a.getExportButton().addEventListener("click",()=>{l.a.localFileContentsToString("./assets/actions_json_schema.json").then(t=>{const e=JSON.parse(localStorage.regions),n=new Ajv,o=JSON.parse(t);n.addSchema(o,"schema").validate("schema",e)?l.a.saveBlobToFile(new Blob([localStorage.regions],{type:"application/json"}),"actions.json"):alert("Cannot export : \n"+this.ajvErrorsToErrorMessage(JSON.stringify(n.errors)))})})}ajvErrorsToErrorMessage(t){const e=JSON.parse(t),n=/\[([0-9]+)].*/,o=[];return e.forEach(t=>{const e=parseInt(n.exec(t.dataPath)[1]),i=JSON.parse(localStorage.regions)[e],r="- region "+(e+1)+" ("+i.data.action.type+", "+i.start+" -> "+i.end+") "+t.message;o.push(r)}),o.join("\n")}getRegionsIdSorted(){return Object.keys(this.wavesurfer.regions.list).sort((t,e)=>{const n=this.wavesurfer.regions.list[t],o=this.wavesurfer.regions.list[e],i=n.start,r=n.end,s=o.start,a=o.end;return i-s==0?r-i-(a-s):i-s})}loadRegions(t){t.forEach(t=>{t.color=this.randomColor(.5);const e=t.data.action.options,n=t.data.action.type;let l,u;switch(n){case"draw_arrow":l=new m.b(e.originX,e.originY,e.destinationX,e.destinationY,e.lineWidth,e.color),u=new m.a(this.canvas,l);break;case"draw_circle":l=new i.b(e.centerX,e.centerY,e.radius,e.borderSize,e.color),u=new i.a(this.canvas,l);break;case"draw_point":l=new d.b(e.centerX,e.centerY,e.radius,e.color),u=new d.a(this.canvas,l);break;case"draw_rectangle":l=new o.b(e.topLeftX,e.topLeftY,e.bottomRightX,e.bottomRightY,e.borderSize,e.color),u=new o.a(this.canvas,l);break;case"draw_xcross":l=new r.b(e.centerX,e.centerY,e.radius,e.lineWidth,e.color),u=new r.a(this.canvas,e);break;case"zoom":l=new s.b(e.topLeftX,e.topLeftY,e.bottomRightX,e.bottomRightY),u=new s.a(this.canvas,l);break;case"subtitle":l=new a.b(e.text,e.position,e.backgroundColor,e.backgroundColorOpacity,e.textColor,e.fontSize,"Roboto Medium"),u=new a.a(this.canvas,l);break;case"focus_rectangle":l=new c.b(e.topLeftX,e.topLeftY,e.bottomRightX,e.bottomRightY),u=new c.a(this.canvas,l);break;default:throw new Error("Unsupported action : "+n)}t.data.action=u,t.data.action.type=n,t.data.action.options=l,this.wavesurfer.addRegion(t)})}deleteRegion(t){if(null!=t){const e=t.id;null!=this.wavesurfer.regions.list[e]&&(this.wavesurfer.regions.list[e].remove(),this.selectedRegion=void 0,this.editFormHandler.editForm.reset(),this.saveRegions())}}randomColor(t){return"rgba("+[~~(255*Math.random()),~~(255*Math.random()),~~(255*Math.random()),t||1]+")"}}},function(t,e,n){n(12),n(11),n(13),t.exports=n(15)},function(t,e,n){"use strict";n.r(e);var o=n(12);window.addEventListener("DOMContentLoaded",()=>{if(!window.AudioContext){const t="Web Audio not supported, change your browser";throw alert(t),new Error(t)}(new o.App).run()})}]);